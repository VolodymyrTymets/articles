# Node js однопоточний? Як розпаралелити node js додаток.

Node js розроблявся як однопоточний асинхронний потік викликів. Це означає що ваш код виконуватиметься в одному потоці.
Така архітектура була експерементальною і була дещо відмінною від існуючих де на кожну операцію виділялвся окремий потік.
І вона оправдала себе в системах with streaming and low latency in mind. Ось чудове пояснення  [чому node js однопоточний](https://stackoverflow.com/questions/17959663/why-is-node-js-single-threaded)
З іншої сторони така архітектура не зовсім підходить для задач які вимагають серьозних ресурсих затрат і є накладними для процесора (складні математичні розрахунки, робота з великими файлами). На щастя node js не зовсім однопоточний і дозволяє вам оперувати власними потоками і писати багатопоточні рішення. From https://nodejs.org/en/about/
> Just because Node is designed without threads, doesn't mean you cannot take advantage of multiple cores in your environment. Child processes can be spawned by using our child_process.fork() API, and are designed to be easy to communicate with. Built upon that same interface is the cluster module, which allows you to share sockets between processes to enable load balancing over your cores.
##  Постановка задачі

Не так давно мені прийшлося реалізовувати невеличкий алгоритм генерування сигналів із виликою частотою. Основна задача якого полягала у генерування цих сигналів кожні n мікросекунд. Цоб це реалізувати я використовав пакет [sleep](https://www.npmjs.com/package/sleep) і наткнувся на певну проблему. Основний потік зависав під час роботи алгоритму і UI замерзав. Прийшлося використовувати потоки щоб запускати даний алоритм у окремому потоці. Таким чином проблема була вирішенна.

Після чого я подумав в яких типових задачах можна застосувати даний підхід. на думку прийшла робота із файлами. Тому я вирішив написати цю статтю взявши за основу невеличкий алгоритм, показавши його роботу в одному та декількох потоках.

Припустимо у вас є декілька файлів абож ціла куча. Це може бути .json .csv .exel не важливо. І вам слід провести якусь операцію над цими фалами розпарсити, зжати проффільтрувати і так далі. Якщо ваш алгоритм виконуватиметься в одному потоці він оброблятимк один файл за одним і це забере досить багато часу. 

Для прикладу я я взяв роботу .wav файлами. Суть в тому щоб взяти максимальні спектри .wav файлів і записати їх у .json. Спектри беруться за допомогою алгоритму fft. Він є досить ресурсозатратний що є ідеальним для даної статті.

Ось який результат роботи алгоритму в одному потоці і декількох. В одному файли обробляюьтся по черзі і в два рази довше

Обробка файлі в одному потоці
![](https://github.com/VolodymyrTymets/articles/blob/master/js-threds/img/single-thread.gif?raw=true)
Обробка файлі в  кількох потоках
![](https://github.com/VolodymyrTymets/articles/blob/master/js-threds/img/threads.gif?raw=true)

## Реалізація 